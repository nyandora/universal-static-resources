<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="618px" preserveAspectRatio="none" style="width:2223px;height:618px;background:#FFFFFF;" version="1.1" viewBox="0 0 2223 618" width="2223px" zoomAndPan="magnify"><defs><filter height="300%" id="f1anhlqrird65z" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="42" x2="42" y1="40.4883" y2="574.5938"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="214" x2="214" y1="40.4883" y2="574.5938"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="472" x2="472" y1="40.4883" y2="574.5938"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="598" x2="598" y1="40.4883" y2="574.5938"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="776" x2="776" y1="40.4883" y2="574.5938"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="973" x2="973" y1="40.4883" y2="574.5938"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1130" x2="1130" y1="40.4883" y2="574.5938"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1294" x2="1294" y1="40.4883" y2="574.5938"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1552.5" x2="1552.5" y1="40.4883" y2="574.5938"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1753.5" x2="1753.5" y1="40.4883" y2="574.5938"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1938.5" x2="1938.5" y1="40.4883" y2="574.5938"/><rect fill="#FEFECE" filter="url(#f1anhlqrird65z)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="70" x="5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="12" y="25.5352">ブラウザ</text><rect fill="#FEFECE" filter="url(#f1anhlqrird65z)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="70" x="5" y="573.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="12" y="594.1289">ブラウザ</text><rect fill="#FEFECE" filter="url(#f1anhlqrird65z)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="247" x="89" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="233" x="96" y="25.5352">Tomcat(AbstractProcessorLight等)</text><rect fill="#FEFECE" filter="url(#f1anhlqrird65z)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="247" x="89" y="573.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="233" x="96" y="594.1289">Tomcat(AbstractProcessorLight等)</text><rect fill="#FEFECE" filter="url(#f1anhlqrird65z)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="133" x="404" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="119" x="411" y="25.5352">DispatcherServlet</text><rect fill="#FEFECE" filter="url(#f1anhlqrird65z)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="133" x="404" y="573.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="119" x="411" y="594.1289">DispatcherServlet</text><rect fill="#FEFECE" filter="url(#f1anhlqrird65z)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="90" x="551" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="76" x="558" y="25.5352">Interceptor</text><rect fill="#FEFECE" filter="url(#f1anhlqrird65z)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="90" x="551" y="573.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="76" x="558" y="594.1289">Interceptor</text><rect fill="#FEFECE" filter="url(#f1anhlqrird65z)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="238" x="655" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="224" x="662" y="25.5352">RequestMappingHandlerAdapter</text><rect fill="#FEFECE" filter="url(#f1anhlqrird65z)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="238" x="655" y="573.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="224" x="662" y="594.1289">RequestMappingHandlerAdapter</text><rect fill="#FEFECE" filter="url(#f1anhlqrird65z)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="129" x="907" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="115" x="914" y="25.5352">ControllerAdvice</text><rect fill="#FEFECE" filter="url(#f1anhlqrird65z)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="129" x="907" y="573.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="115" x="914" y="594.1289">ControllerAdvice</text><rect fill="#FEFECE" filter="url(#f1anhlqrird65z)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="157" x="1050" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="143" x="1057" y="25.5352">ReactiveTypeHandler</text><rect fill="#FEFECE" filter="url(#f1anhlqrird65z)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="157" x="1050" y="573.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="143" x="1057" y="594.1289">ReactiveTypeHandler</text><rect fill="#FEFECE" filter="url(#f1anhlqrird65z)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="143" x="1221" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="129" x="1228" y="25.5352">WebAsyncManager</text><rect fill="#FEFECE" filter="url(#f1anhlqrird65z)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="143" x="1221" y="573.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="129" x="1228" y="594.1289">WebAsyncManager</text><rect fill="#FEFECE" filter="url(#f1anhlqrird65z)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="116" x="1492.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="102" x="1499.5" y="25.5352">DeferredResult</text><rect fill="#FEFECE" filter="url(#f1anhlqrird65z)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="116" x="1492.5" y="573.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="102" x="1499.5" y="594.1289">DeferredResult</text><rect fill="#FEFECE" filter="url(#f1anhlqrird65z)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="258" x="1622.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="244" x="1629.5" y="25.5352">HandlerMethodReturnValueHandler</text><rect fill="#FEFECE" filter="url(#f1anhlqrird65z)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="258" x="1622.5" y="573.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="244" x="1629.5" y="594.1289">HandlerMethodReturnValueHandler</text><rect fill="#FEFECE" filter="url(#f1anhlqrird65z)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="84" x="1894.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70" x="1901.5" y="25.5352">Controller</text><rect fill="#FEFECE" filter="url(#f1anhlqrird65z)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="84" x="1894.5" y="573.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70" x="1901.5" y="594.1289">Controller</text><polygon fill="#A80036" points="202.5,52.4883,212.5,56.4883,202.5,60.4883,206.5,56.4883" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="42" x2="208.5" y1="56.4883" y2="56.4883"/><polygon fill="#A80036" points="460.5,66.4883,470.5,70.4883,460.5,74.4883,464.5,70.4883" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="214.5" x2="466.5" y1="70.4883" y2="70.4883"/><polygon fill="#A80036" points="586,80.4883,596,84.4883,586,88.4883,590,84.4883" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="472.5" x2="592" y1="84.4883" y2="84.4883"/><polygon fill="#A80036" points="764,94.4883,774,98.4883,764,102.4883,768,98.4883" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="472.5" x2="770" y1="98.4883" y2="98.4883"/><polygon fill="#A80036" points="961.5,108.4883,971.5,112.4883,961.5,116.4883,965.5,112.4883" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="776" x2="967.5" y1="112.4883" y2="112.4883"/><polygon fill="#A80036" points="1118.5,122.4883,1128.5,126.4883,1118.5,130.4883,1122.5,126.4883" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="776" x2="1124.5" y1="126.4883" y2="126.4883"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1130.5" x2="1172.5" y1="155.7988" y2="155.7988"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1172.5" x2="1172.5" y1="155.7988" y2="168.7988"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1131.5" x2="1172.5" y1="168.7988" y2="168.7988"/><polygon fill="#A80036" points="1141.5,164.7988,1131.5,168.7988,1141.5,172.7988,1137.5,168.7988" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="132" x="1137.5" y="151.0566">Publisherをsubscribe</text><polygon fill="#A80036" points="1926.5,194.1094,1936.5,198.1094,1926.5,202.1094,1930.5,198.1094" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1130.5" x2="1932.5" y1="198.1094" y2="198.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="245" x="1137.5" y="193.3672">Contorllerのsuspend funを非同期で起動</text><polygon fill="#A80036" points="1282.5,208.1094,1292.5,212.1094,1282.5,216.1094,1286.5,212.1094" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1130.5" x2="1288.5" y1="212.1094" y2="212.1094"/><polygon fill="#A80036" points="1540.5,237.4199,1550.5,241.4199,1540.5,245.4199,1544.5,241.4199" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1294.5" x2="1546.5" y1="241.4199" y2="241.4199"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="234" x="1301.5" y="236.6777">非同期処理終了時のコールバックを登録</text><polygon fill="#A80036" points="787,251.4199,777,255.4199,787,259.4199,783,255.4199" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="781" x2="1129.5" y1="255.4199" y2="255.4199"/><polygon fill="#A80036" points="483.5,265.4199,473.5,269.4199,483.5,273.4199,479.5,269.4199" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="477.5" x2="775" y1="269.4199" y2="269.4199"/><polygon fill="#A80036" points="225.5,294.7305,215.5,298.7305,225.5,302.7305,221.5,298.7305" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="219.5" x2="471.5" y1="298.7305" y2="298.7305"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="234" x="231.5" y="293.9883">非同期処理をキックしたので制御が戻る</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1938.5" x2="1980.5" y1="328.041" y2="328.041"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1980.5" x2="1980.5" y1="328.041" y2="341.041"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1939.5" x2="1980.5" y1="341.041" y2="341.041"/><polygon fill="#A80036" points="1949.5,337.041,1939.5,341.041,1949.5,345.041,1945.5,341.041" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="271" x="1945.5" y="323.2988">別スレッドがControllerのsuspend funを実行</text><polygon fill="#A80036" points="1563.5,366.3516,1553.5,370.3516,1563.5,374.3516,1559.5,370.3516" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1557.5" x2="1937.5" y1="370.3516" y2="370.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="195" x="1569.5" y="365.6094">非同期処理が完了したことを通知</text><polygon fill="#A80036" points="225.5,395.6621,215.5,399.6621,225.5,403.6621,221.5,399.6621" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="219.5" x2="1551.5" y1="399.6621" y2="399.6621"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143" x="231.5" y="394.9199">続きを実行するよう指示</text><polygon fill="#A80036" points="460.5,424.9727,470.5,428.9727,460.5,432.9727,464.5,428.9727" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="214.5" x2="466.5" y1="428.9727" y2="428.9727"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="221.5" y="424.2305">再度ディスパッチする</text><polygon fill="#A80036" points="586,438.9727,596,442.9727,586,446.9727,590,442.9727" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="472.5" x2="592" y1="442.9727" y2="442.9727"/><polygon fill="#A80036" points="764,452.9727,774,456.9727,764,460.9727,768,456.9727" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="472.5" x2="770" y1="456.9727" y2="456.9727"/><polygon fill="#A80036" points="961.5,466.9727,971.5,470.9727,961.5,474.9727,965.5,470.9727" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="776" x2="967.5" y1="470.9727" y2="470.9727"/><polygon fill="#A80036" points="1282.5,496.2832,1292.5,500.2832,1282.5,504.2832,1286.5,500.2832" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="776" x2="1288.5" y1="500.2832" y2="500.2832"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="245" x="783" y="495.541">非同期で実行したControllerの結果を取得</text><polygon fill="#A80036" points="1741.5,510.2832,1751.5,514.2832,1741.5,518.2832,1745.5,514.2832" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="776" x2="1747.5" y1="514.2832" y2="514.2832"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1753.5" x2="1795.5" y1="543.5938" y2="543.5938"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1795.5" x2="1795.5" y1="543.5938" y2="556.5938"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1754.5" x2="1795.5" y1="556.5938" y2="556.5938"/><polygon fill="#A80036" points="1764.5,552.5938,1754.5,556.5938,1764.5,560.5938,1760.5,556.5938" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="1760.5" y="538.8516">ブラウザにレスポンス</text><!--MD5=[dc00251966e06ef2cc4f59bb996c69e8]
@startuml　seq
participant ブラウザ as browser
participant "Tomcat(AbstractProcessorLight等)" as tomcat
participant DispatcherServlet as servlet
participant Interceptor as interceptor
participant RequestMappingHandlerAdapter as adapter
participant ControllerAdvice as advice
participant ReactiveTypeHandler as reactiveHandler
participant WebAsyncManager as waManager
participant DeferredResult as deferredResult
participant HandlerMethodReturnValueHandler as hmrvHandler
participant Controller as handler

browser -> tomcat
tomcat -> servlet
servlet -> interceptor
servlet -> adapter
adapter -> advice
adapter -> reactiveHandler
reactiveHandler -> reactiveHandler: Publisherをsubscribe
reactiveHandler -> handler: Contorllerのsuspend funを非同期で起動
reactiveHandler -> waManager
waManager -> deferredResult: 非同期処理終了時のコールバックを登録
reactiveHandler - -> adapter
adapter - -> servlet
servlet - -> tomcat: 非同期処理をキックしたので制御が戻る
handler -> handler: 別スレッドがControllerのsuspend funを実行
handler - -> deferredResult: 非同期処理が完了したことを通知
deferredResult - -> tomcat: 続きを実行するよう指示
tomcat -> servlet: 再度ディスパッチする
servlet -> interceptor
servlet -> adapter
adapter -> advice
adapter -> waManager: 非同期で実行したControllerの結果を取得
adapter -> hmrvHandler
hmrvHandler -> hmrvHandler: ブラウザにレスポンス

@enduml

PlantUML version 1.2022.0(Wed Jan 12 01:16:42 JST 2022)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: ja
Country: JP
--></g></svg>